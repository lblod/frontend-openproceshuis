<SidebarContainer>
  <:sidebar>
    <Inventory::SidebarFilters
      @params={{@model.params}}
      @onFilterApplied={{this.updateFilters}}
    />
  </:sidebar>
  <:content>
    <PageHeader>
      <:title>Inventaris processen Lokale Besturen</:title>
      <:subtitle>
        <AuLinkExternal href="https://abb-vlaanderen.gitbook.io/informatie-oph">
          Handleiding Open Proces Huis
        </AuLinkExternal>
      </:subtitle>
      <:action>
        {{#if this.currentSession.isAdmin}}
          <AuButton
            @skin="secondary"
            @icon="add"
            iconAlignment="left"
            {{on "click" (fn this.openUpsertModal null)}}
          >Nieuw proces</AuButton>
        {{/if}}
        <AuButton
          @disabled={{eq @model.tableContent.content.length 0}}
          @skin="primary"
          @icon="download"
          iconAlignment="left"
          {{on "click" (fn (mut this.isDownloadModalOpen) true)}}
        >Download</AuButton>
      </:action>
    </PageHeader>

    {{#if @model.couldNotFetchTableContent}}
      <TableMessage::Error />
    {{else}}
      <AuDataTable
        @content={{@model.tableContent.content}}
        @page={{this.page}}
        @size={{this.size}}
        @noDataMessage="Er werden geen zoekresultaten gevonden."
        as |t|
      >
        <t.content class="au-c-data-table__table--small" as |c|>
          <c.header>
            {{#each @model.tableContent.sortableHeaderLabels as |header|}}
              <AuDataTableThSortable
                @field={{header.field}}
                @currentSorting={{this.sort}}
                @label={{header.label}}
              />
            {{/each}}
          </c.header>
          <c.body as |conceptualProcess|>
            <InventoryProcessTableRow
              @process={{conceptualProcess}}
              @labels={{@model.tableContent.headerLabels}}
              @onEditInventoryProcess={{this.openUpsertModal}}
              @onOpenDeleteModal={{this.openDeleteModal}}
            />
          </c.body>
        </t.content>
      </AuDataTable>
    {{/if}}
  </:content>
</SidebarContainer>

{{#if this.isUpsertModalOpen}}
  <Inventory::UpsertProcessModal
    @process={{this.process}}
    @onProcessSaved={{this.onProcessSaved}}
    @onClose={{this.onCloseUpsertModal}}
  />
{{/if}}

<Inventory::DeleteProcessModal
  @isOpen={{this.isDeleteModalOpen}}
  @process={{this.process}}
  @onProcessDeleted={{this.onProcessDeleted}}
  @onClose={{this.onCloseDeleteModal}}
/>

<DownloadModal::InventoryProcesses
  @isOpen={{this.isDownloadModalOpen}}
  @onClose={{fn (mut this.isDownloadModalOpen) false}}
  @onClickedDownloadButton={{fn (mut this.isDownloadModalOpen) false}}
  @downloadOptions={{@model.params}}
/>